#!/bin/bash
# ---------------------------------------------------------- #
# JMonkeyEngine Project Runner
# ---------------------------------------------------------- #
# Base directories
PROJECT_DIR="/home/zuckram/jMonkeyProject/HelloJME3"
BASE_DIR="/home/zuckram/LIB_Development"
LIB_DIR="$BASE_DIR/lib"

# Source and output directories
SRC_DIR="$PROJECT_DIR/src/mygame"
OUT_DIR="$BASE_DIR/out"

# Main class configuration
SOURCE_FILES="$SRC_DIR/*.java"
#MAIN_CLASS="mygame.JumpyHopi"
MAIN_CLASS="mygame.movingAnimatedCharacter"

# Create output directory if it doesn't exist
mkdir -p "$OUT_DIR"

# ---------------------------------------------------------- #
# JME JAR Collection
# ---------------------------------------------------------- #
declare -a JME_JARS=()
# Add core JARs
for jar in "$LIB_DIR/jMonkeyEngine/essentials/core"/*.jar; do
    if [[ -f "$jar" ]]; then
        JME_JARS+=("$jar")
    fi
done

# Add LWJGL JARs
for jar in "$LIB_DIR/jMonkeyEngine/essentials/lwjgl"/*.jar; do
    if [[ -f "$jar" ]]; then
        JME_JARS+=("$jar")
    fi
done

# Add optional JARs
for jar in "$LIB_DIR/jMonkeyEngine/essentials/optional"/*.jar; do
    if [[ -f "$jar" ]]; then
        JME_JARS+=("$jar")
    fi
done

for jar in "$LIB_DIR/jMonkeyEngine/essentials/physics"/*.jar; do
    if [[ -f "$jar" ]]; then
        JME_JARS+=("$jar")
    fi
done

# ---------------------------------------------------------- #
# Classpath Creation
# ---------------------------------------------------------- #
create_classpath() {
    local classpath=""
    for jar in "$@"; do
        if [ -z "$classpath" ]; then
            classpath="$jar"
        else
            classpath="$classpath:$jar"
        fi
    done
    echo "$classpath"
}

COMPILE_CLASSPATH=$(create_classpath "${JME_JARS[@]}")
RUNTIME_CLASSPATH="$OUT_DIR:$(create_classpath "${JME_JARS[@]}")"

# ---------------------------------------------------------- #
# Compilation
# ---------------------------------------------------------- #
echo "Compiling JMonkeyEngine application..."
echo "Source files: $SOURCE_FILES"
javac --release 17 -cp "$COMPILE_CLASSPATH" \
      -d "$OUT_DIR" \
      $SOURCE_FILES

if [ $? -eq 0 ]; then
    echo "Compilation successful!"
else
    echo "Compilation failed!"
    exit 1
fi

# ---------------------------------------------------------- #
# Execution
# ---------------------------------------------------------- #
echo "Starting JMonkeyEngine application..."
java -Xss16m \
     -Djava.library.path="$LIB_DIR/jMonkeyEngine/essentials/lwjgl" \
     -cp "$RUNTIME_CLASSPATH" \
     "$MAIN_CLASS"
